"use strict";(self.webpackChunknoslate_website=self.webpackChunknoslate_website||[]).push([[621],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||o;return n?r.createElement(h,l(l({ref:t},c),{},{components:n})):r.createElement(h,l({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var u=2;u<o;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7042:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>u});var r=n(7462),a=(n(7294),n(3905));const o={},l="Used in Alibaba Cloud Function Compute",i={unversionedId:"noslate_workers/getting_started/aliyun_fc",id:"noslate_workers/getting_started/aliyun_fc",title:"Used in Alibaba Cloud Function Compute",description:"Alibaba Cloud Function Compute supports the use of container images as function deliverables, that is the Custom Container capability. Therefore, Noslate can be combined with Function Compute to achieve more fine-grained hierarchical scheduling capabilities.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/noslate_workers/getting_started/aliyun_fc.md",sourceDirName:"noslate_workers/getting_started",slug:"/noslate_workers/getting_started/aliyun_fc",permalink:"/en/docs/noslate_workers/getting_started/aliyun_fc",draft:!1,editUrl:"https://github.com/noslate-project/noslate/tree/main/site/docs/noslate_workers/getting_started/aliyun_fc.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"Deploy Noslate with Docker",permalink:"/en/docs/noslate_workers/getting_started/docker"},next:{title:"Aworker Introduction",permalink:"/en/docs/noslate_workers/aworker/intro"}},s={},u=[{value:"Quick start",id:"quick-start",level:2},{value:"Custom image",id:"custom-image",level:2},{value:"Define Noslate",id:"define-noslate",level:3},{value:"Define HTTP server",id:"define-http-server",level:3},{value:"Define ENTRYPOINT",id:"define-entrypoint",level:3},{value:"Start Turfd",id:"start-turfd",level:4},{value:"Start Noslated",id:"start-noslated",level:4},{value:"Start HTTP server",id:"start-http-server",level:4},{value:"Build image",id:"build-image",level:3}],c={toc:u};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"used-in-alibaba-cloud-function-compute"},"Used in Alibaba Cloud Function Compute"),(0,a.kt)("p",null,"Alibaba Cloud Function Compute supports the use of container images as function deliverables, that is the Custom Container capability. Therefore, Noslate can be combined with Function Compute to achieve more fine-grained hierarchical scheduling capabilities."),(0,a.kt)("h2",{id:"quick-start"},"Quick start"),(0,a.kt)("p",null,"You can refer to the ",(0,a.kt)("a",{parentName:"p",href:"https://help.aliyun.com/document_detail/179368.html"},"Function Compute - CustomContainer")," document, to deploy the following images in Function Compute:: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"docker pull ghcr.io/noslate-project/noslate-aliyunfc:0.0.1\n")),(0,a.kt)("p",null,"If you want to customize the mirror content, you can read the following steps."),(0,a.kt)("h2",{id:"custom-image"},"Custom image"),(0,a.kt)("p",null,"Next, use the above example image to demonstrate how to customize the function computing container image. This image uses the Web Server mode, so it mainly consists of two parts:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Noslate"),(0,a.kt)("li",{parentName:"ol"},"HTTP Server")),(0,a.kt)("h3",{id:"define-noslate"},"Define Noslate"),(0,a.kt)("p",null,"If there is no image custom requirement, you can directly use the distribution image provided by Noslate:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ARG NOSLATE_VERSION\n\nFROM noslate:${NOSLATE_VERSION:-0.0.1}\n")),(0,a.kt)("p",null,"If there is custom image requirement ",(0,a.kt)("a",{parentName:"p",href:"/en/docs/noslate_workers/getting_started/aliyun_fc"},"Deploy Noslate with Docker"),"\u3002"),(0,a.kt)("h3",{id:"define-http-server"},"Define HTTP server"),(0,a.kt)("p",null,"You can choose a framework to provide HTTP services according to your usage habits, process the calls sent by the function computing gateway, and use Noslate to process the request return results."),(0,a.kt)("p",null,"The calls made by Function Compute are:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"invoke path"),(0,a.kt)("th",{parentName:"tr",align:null},"request"),(0,a.kt)("th",{parentName:"tr",align:null},"reponse"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"/initialize"),(0,a.kt)("td",{parentName:"tr",align:null},"refer to ",(0,a.kt)("a",{parentName:"td",href:"https://help.aliyun.com/document_detail/425057.htm#section-3f8-5y1-i77"},"Function Compute Common Request Header")),(0,a.kt)("td",{parentName:"tr",align:null},"StatusCode",(0,a.kt)("ul",null,(0,a.kt)("li",null,"200: Success Status"),(0,a.kt)("li",null,"404: Failed Status")))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"/pre-freeze"),(0,a.kt)("td",{parentName:"tr",align:null},"refer to ",(0,a.kt)("a",{parentName:"td",href:"https://help.aliyun.com/document_detail/425057.htm#section-3f8-5y1-i77"},"Function Compute Common Request Header")),(0,a.kt)("td",{parentName:"tr",align:null},"StatusCode",(0,a.kt)("ul",null,(0,a.kt)("li",null,"200: Success Status"),(0,a.kt)("li",null,"404: Failed Status")))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"/pre-stop"),(0,a.kt)("td",{parentName:"tr",align:null},"refer to ",(0,a.kt)("a",{parentName:"td",href:"https://help.aliyun.com/document_detail/425057.htm#section-3f8-5y1-i77"},"Function Compute Common Request Header")),(0,a.kt)("td",{parentName:"tr",align:null},"StatusCode",(0,a.kt)("ul",null,(0,a.kt)("li",null,"200: Success Status"),(0,a.kt)("li",null,"404: Failed Status")))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"/invoke"),(0,a.kt)("td",{parentName:"tr",align:null},"function call data and ",(0,a.kt)("a",{parentName:"td",href:"https://help.aliyun.com/document_detail/425057.htm#section-3f8-5y1-i77"},"Function Compute Common Request Header")),(0,a.kt)("td",{parentName:"tr",align:null},"The returned data of function handler, includes response codes and response headers.\u3002StatusCode",(0,a.kt)("ul",null,(0,a.kt)("li",null,"200: Success Status"),(0,a.kt)("li",null,"404: Failed Status")))))),(0,a.kt)("p",null,"For more details refer to ",(0,a.kt)("a",{parentName:"p",href:"https://help.aliyun.com/document_detail/427627.html"},"Function instance lifecycle callback")),(0,a.kt)("p",null,"To meet the spefic needs, you can process the corresponding request. If you have any questions, you can refer to the HTTP request handler ",(0,a.kt)("a",{parentName:"p",href:"https://help.aliyun.com/document_detail/179371.html"},"HTTP Handler"),"\u3002"),(0,a.kt)("p",null,"In order to be able to hand over the request to Noslate for processing, in ",(0,a.kt)("strong",{parentName:"p"},"/invoke"),", you need to import the ",(0,a.kt)("a",{parentName:"p",href:"/en/docs/noslate_workers/references/sdk"},"SDK")," provided by Noslate and forward the request, you can refer to ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/noslate-project/noslate_workers/tree/main/distro/resources/aliyun/server.js"},"server.js"),": "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"// Environment variables preset in the image\nconst NoslatedClient = require(process.env.NOSLATE_PATH).NoslatedClient;\n\n// Initialize agent\nconst agent = new NoslatedClient();\nawait agent.start();\n\n// Forward the request\napp.post('/invoke', async (req, res) => {\n    const response = await agent.invoke(functionName, req, metadata);\n\n    response.pipe(res);\n});\n")),(0,a.kt)("p",null,"Integrate the HTTP Server into the container and expose the listening port to the outside"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"# Can be customized\nENV SERVER_PATH=/code\nENV SERVER_PORT=9000\n\nRUN mkdir ${SERVER_PATH}\nCOPY resources/aliyun/server.js ${SERVER_PATH}/server.js\n\nEXPOSE ${SERVER_PORT}\n")),(0,a.kt)("h3",{id:"define-entrypoint"},"Define ENTRYPOINT"),(0,a.kt)("p",null,"In ENTRYPOINT, we need to run the various components of Noslate and the above HTTP Server:"),(0,a.kt)("h4",{id:"start-turfd"},"Start Turfd"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"start_turfd() {\n    TURF_LOG=${NOSLATE_LOGDIR}/turf.log\n    nohup ${NOSLATE_BIN}/turf -D -f >${TURF_LOG} 2>&1\n}\n")),(0,a.kt)("h4",{id:"start-noslated"},"Start Noslated"),(0,a.kt)("p",null,"Noslated includes Data Plane and Control Plane, for more details you can refer to ",(0,a.kt)("a",{parentName:"p",href:"noslate_workers/noslated/intro"},"Noslated Inctroduction"),". The boot order of the two is not required\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"start_planes() {\n    node ${NOSLATE_BIN}/data_plane &\n    node ${NOSLATE_BIN}/control_plane &\n}\n")),(0,a.kt)("h4",{id:"start-http-server"},"Start HTTP server"),(0,a.kt)("p",null,"The HTTP Server will establish a connection with the Data Plane and Control Plane, and it is recommended to start it at the end to keep the container running."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"start_server() {\n    node ${SERVER_PATH}/server.js\n}\n")),(0,a.kt)("p",null,"Here is a written ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/noslate-project/noslate_workers/tree/main/distro/resources/aliyun/start.sh"},"start.sh")," for reference\u3002"),(0,a.kt)("p",null,"Copy this file to the image, increase the execution permission, and specify it as the ENTRYPOINT of the container."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"COPY resources/aliyun/start.sh ${SERVER_PATH}/start.sh\nENTRYPOINT ${SERVER_PATH}/start.sh start\n")),(0,a.kt)("h3",{id:"build-image"},"Build image"),(0,a.kt)("p",null,"At this point, the custom image content has been completed, and we can execute the build."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"docker build --build-arg NOSLATE_VERSION=0.0.1 noslate-aliyunfc.dockerfile -t noslate-aliyunfc\n")),(0,a.kt)("p",null,"After that, you can publish the function according to the Alibaba Cloud function computing process, refer to ",(0,a.kt)("a",{parentName:"p",href:"https://help.aliyun.com/document_detail/179372.html"},"Create Custom Container Function"),"\u3002"))}p.isMDXComponent=!0}}]);