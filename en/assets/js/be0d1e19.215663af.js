"use strict";(self.webpackChunknoslate_website=self.webpackChunknoslate_website||[]).push([[8219],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),d=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(r),m=a,k=p["".concat(s,".").concat(m)]||p[m]||u[m]||o;return r?n.createElement(k,i(i({ref:t},c),{},{components:r})):n.createElement(k,i({ref:t},c))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var d=2;d<o;d++)i[d]=r[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}p.displayName="MDXCreateElement"},7440:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var n=r(7462),a=(r(7294),r(3905));const o={},i="Deploy Noslate with Docker",l={unversionedId:"noslate_workers/getting_started/docker",id:"noslate_workers/getting_started/docker",title:"Deploy Noslate with Docker",description:"Noslate can be quickly deployed into the existing cluster architecture in the form of Docker images, and cooperate with upper-level scheduling to achieve finer-grained scheduling and high-density deployment.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/noslate_workers/getting_started/docker.md",sourceDirName:"noslate_workers/getting_started",slug:"/noslate_workers/getting_started/docker",permalink:"/en/docs/noslate_workers/getting_started/docker",draft:!1,editUrl:"https://github.com/noslate-project/noslate/tree/main/site/docs/noslate_workers/getting_started/docker.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"",permalink:"/en/docs/noslate_workers/intro"},next:{title:"Used in Alibaba Cloud Function Compute",permalink:"/en/docs/noslate_workers/getting_started/aliyun_fc"}},s={},d=[{value:"Quick start",id:"quick-start",level:2},{value:"Custom image",id:"custom-image",level:2},{value:"Determine the dependent image version",id:"determine-the-dependent-image-version",level:3},{value:"Create the required directory",id:"create-the-required-directory",level:3},{value:"Integrate Gateway components",id:"integrate-gateway-components",level:3},{value:"Define ENTRYPOINT",id:"define-entrypoint",level:3},{value:"Start Turfd",id:"start-turfd",level:4},{value:"Start Noslated",id:"start-noslated",level:4},{value:"Start Gateway",id:"start-gateway",level:4},{value:"Build image",id:"build-image",level:3}],c={toc:d};function u(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"deploy-noslate-with-docker"},"Deploy Noslate with Docker"),(0,a.kt)("p",null,"Noslate can be quickly deployed into the existing cluster architecture in the form of Docker images, and cooperate with upper-level scheduling to achieve finer-grained scheduling and high-density deployment."),(0,a.kt)("h2",{id:"quick-start"},"Quick start"),(0,a.kt)("p",null,"If you want to experience Noslate directly locally, do the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"docker pull ghcr.io/noslate-project/noslate-demo:0.0.1\ndocker run -d ghcr.io/noslate-project/noslate-demo:0.0.1\n")),(0,a.kt)("p",null,"If you want to customize the mirror content, you can continue reading."),(0,a.kt)("h2",{id:"custom-image"},"Custom image"),(0,a.kt)("p",null,"Next, let's build a sample image to demonstrate how to customize the image:"),(0,a.kt)("h3",{id:"determine-the-dependent-image-version"},"Determine the dependent image version"),(0,a.kt)("p",null,"Confirm the version number you want to use in ",(0,a.kt)("a",{parentName:"p",href:"/en/docs/noslate_workers/release_notes"},"version history"),", and introduce it in the Dockerfile:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ARG NOSLATE_VERSION\n\nFROM noslate:${NOSLATE_VERSION:-0.0.1}\n")),(0,a.kt)("p",null,"Taking 0.0.1 as an example, in order to easily update Noslate in the future, the version can be passed in as a build parameter, and specified when building:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"docker build --build-arg NOSLATE_VERSION=0.0.1\n")),(0,a.kt)("h3",{id:"create-the-required-directory"},"Create the required directory"),(0,a.kt)("p",null,"Most of the required directories have been created in the Noslate image, but the log file directory has not been created. It can be created according to the location specified by the environment variable ",(0,a.kt)("strong",{parentName:"p"},"NOSLATE_LOGDIR"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"RUN mkdir -p $NOSLATE_LOGDIR\n")),(0,a.kt)("p",null,"It is also possible to override this environment variable and create a directory of files as required:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ENV $NOSLATE_LOGDIR=/home/admin/logs\nRUN mkdir -p $NOSLATE_LOGDIR\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"For more information about log processing, please refer to ",(0,a.kt)("a",{parentName:"li",href:"/en/docs/noslate_workers/tutorials/logging"},"Log Processing"),"."),(0,a.kt)("li",{parentName:"ul"},"For more information about environment variables, please refer to ",(0,a.kt)("a",{parentName:"li",href:"/en/docs/noslate_workers/references/envionment_variables"},"Environment Variables"))),(0,a.kt)("h3",{id:"integrate-gateway-components"},"Integrate Gateway components"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/en/docs/noslate_workers/references/gateway"},"Gateway component introduction")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/en/docs/noslate_workers/tutorials/custom_gateway"},"How to Customize Gateway Components"))),(0,a.kt)("p",null,"Details of the Gateway component can be found in the two documents provided above. Here we use the already written ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/noslate-project/noslate_workers/tree/main/distro/resources/gateway"},"Demo Gateway")," and add it to the image."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ENV GATEWAY_PATH=/gateway\nENV GATEWAY_PORT=80\n\nCOPY resources/gateway $GATEWAY_PATH\n")),(0,a.kt)("h3",{id:"define-entrypoint"},"Define ENTRYPOINT"),(0,a.kt)("p",null,"In ENTRYPOINT, we need to run the components of Noslate and the Gateway above:"),(0,a.kt)("h4",{id:"start-turfd"},"Start Turfd"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"start_turfd() {\n    TURF_LOG=${NOSLATE_LOGDIR}/turf.log\n    nohup ${ALINODE_CLOUD_BIN}/turf -D -f >${TURF_LOG} 2>&1\n}\n")),(0,a.kt)("h4",{id:"start-noslated"},"Start Noslated"),(0,a.kt)("p",null,"Noslated consists of two parts, Data Plane and Control Plane. For details, please refer to the introduction of Noslated. The startup sequence of the two is not required."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"start_planes() {\n    node ${ALINODE_CLOUD_BIN}/data_plane &\n    node ${ALINODE_CLOUD_BIN}/control_plane &\n}\n")),(0,a.kt)("h4",{id:"start-gateway"},"Start Gateway"),(0,a.kt)("p",null,"The Gateway will establish a connection with the Data Plane and Control Plane, and it is recommended to start it last while keeping the container running."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"start_gateway() {\n    node ${GATEWAY_PATH}/server.js\n}\n")),(0,a.kt)("p",null,"Here is a written ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/noslate-project/noslate_workers/tree/main/distro/resources/start.sh"},"start.sh")," for reference."),(0,a.kt)("p",null,"Copy this file to the image, increase the execution permission, and specify it as the ENTRYPOINT of the container."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"COPY resources/start.sh /start.sh\nENTRYPOINT /start.sh start\n")),(0,a.kt)("h3",{id:"build-image"},"Build image"),(0,a.kt)("p",null,"At this point, the custom image content has been completed, and we can execute the build."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"docker build --build-arg NOSLATE_VERSION=0.0.1 noslate-demo.dockerfile -t noslate-demo\n")),(0,a.kt)("p",null,"After building it, run it directly:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"docker run -d noslate-demo\n")))}u.isMDXComponent=!0}}]);