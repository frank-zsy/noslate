"use strict";(self.webpackChunknoslate_website=self.webpackChunknoslate_website||[]).push([[143],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,g=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7839:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const o={},i="Isolate command",l={unversionedId:"debugger/andb/isolate",id:"debugger/andb/isolate",title:"Isolate command",description:"Isolate guess",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/debugger/andb/isolate.md",sourceDirName:"debugger/andb",slug:"/debugger/andb/isolate",permalink:"/en/docs/debugger/andb/isolate",draft:!1,editUrl:"https://github.com/noslate-project/noslate/tree/main/site/docs/debugger/andb/isolate.md",tags:[],version:"current",frontMatter:{},sidebar:"debugger",previous:{title:"Command Line",permalink:"/en/docs/debugger/andb/cli"},next:{title:"v8 command",permalink:"/en/docs/debugger/andb/v8"}},s={},c=[{value:"Isolate guess",id:"isolate-guess",level:2}],p={toc:c};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"isolate-command"},"Isolate command"),(0,r.kt)("h2",{id:"isolate-guess"},"Isolate guess"),(0,r.kt)("p",null,"Locate the ",(0,r.kt)("inlineCode",{parentName:"p"},"v8::internal::Isolate")," structure."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"v8::internal::Isolate")," is the core data structure of the V8 engine, which represents a V8 virtual machine, which has its own Heap (heap), GC (garbage collection), etc.\nMany analysis tools of andb need to be based on this data structure, so generally debugging Corefile should first locate ",(0,r.kt)("inlineCode",{parentName:"p"},"Isolate"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"isolate guess page"),(0,r.kt)("li",{parentName:"ul"},"isolate guess stack")),(0,r.kt)("p",null,"andb currently provides 2 methods to quickly locate ",(0,r.kt)("inlineCode",{parentName:"p"},"Isolate"),","),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"By ",(0,r.kt)("inlineCode",{parentName:"li"},"page"))),(0,r.kt)("p",null,"The V8 engine maintains memory page management by itself, and each page also has a page header fixed for each version, through which the ",(0,r.kt)("inlineCode",{parentName:"p"},"V8::internal::Heap")," structure can be found.\nThe ",(0,r.kt)("inlineCode",{parentName:"p"},"Heap")," structure is part of ",(0,r.kt)("inlineCode",{parentName:"p"},"Isolate"),", so it is possible to find the first address of ",(0,r.kt)("inlineCode",{parentName:"p"},"Isolate"),"."),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"By ",(0,r.kt)("inlineCode",{parentName:"li"},"stack"))),(0,r.kt)("p",null,"Node.js keeps the data of the V8 engine in the local variables of ",(0,r.kt)("inlineCode",{parentName:"p"},"Node::Run()"),", which are stored on the call stack of the main thread,\nThe first address of ",(0,r.kt)("inlineCode",{parentName:"p"},"Isolate")," can be obtained from the main thread stack memory."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(gdb) isolate guess page\n(v8::internal::Isolate *) $isolate = 0x5f93c70\n(gdb) isolate guess stack\n(v8::internal::Isolate *) $isolate = 0x5f93c70\n")),(0,r.kt)("p",null,'Variables prefixed with "\\$" are called Convenience variables. In the above example, you can access the v8 virtual machine through "\\$isolate"'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(gdb) p $isolate->heap_.new_space_\n$2 = (v8::internal::NewSpace *) 0x60296f0\n\n(gdb) p $isolate->heap_.new_space_.to_space_\n$5 = {\n  <v8::internal::Space> = {\n    <v8::internal::Malloced> = {<No data fields>},\n    members of v8::internal::Space:\n    _vptr.Space = 0x23d3890 <vtable for v8::internal::SemiSpace+16>,\n    allocation_observers_ = std::vector of length 0, capacity 0,\n    memory_chunk_list_ = {\n      front_ = 0x667900000,\n      back_ = 0x159131e80000\n    },\n    external_backing_store_bytes_ = 0x6029a20,\n    allocation_observers_paused_ = false,\n    heap_ = 0x5f9d1b8,\n    id_ = v8::internal::NEW_SPACE,\n    committed_ = {\n      <std::__atomic_base<unsigned long>> = {\n        static _S_alignment = 8,\n        _M_i = 1048576\n      }, <No data fields>},\n    max_committed_ = 2097152,\n    free_list_ = std::unique_ptr<v8::internal::FreeList> = {\n      get() = 0x6029980\n    }\n  },\n  members of v8::internal::SemiSpace:\n  current_capacity_ = 1048576,\n  maximum_capacity_ = 16777216,\n  minimum_capacity_ = 1048576,\n  age_mark_ = 27507487032,\n  committed_ = true,\n  id_ = v8::internal::kToSpace,\n  current_page_ = 0x10d414980000,\n  pages_used_ = 2\n}\n")),(0,r.kt)("p",null,"Currently andb only supports a single ",(0,r.kt)("inlineCode",{parentName:"p"},"Isolate"),"."))}d.isMDXComponent=!0}}]);