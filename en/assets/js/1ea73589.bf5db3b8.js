"use strict";(self.webpackChunknoslate_website=self.webpackChunknoslate_website||[]).push([[9722],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},f=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),f=l(n),d=a,m=f["".concat(c,".").concat(d)]||f[d]||p[d]||o;return n?r.createElement(m,i(i({ref:t},u),{},{components:n})):r.createElement(m,i({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=f;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}f.displayName="MDXCreateElement"},8437:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const o={},i="Gateway",s={unversionedId:"noslate_workers/references/gateway",id:"noslate_workers/references/gateway",title:"Gateway",description:"It is mainly used to complete the docking with the external traffic portal, and realize the call to Noslate together with the SDK.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/noslate_workers/references/gateway.md",sourceDirName:"noslate_workers/references",slug:"/noslate_workers/references/gateway",permalink:"/en/docs/noslate_workers/references/gateway",draft:!1,editUrl:"https://github.com/noslate-project/noslate/tree/main/site/docs/noslate_workers/references/gateway.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"Outbound Service Proxy",permalink:"/en/docs/noslate_workers/references/outbound"},next:{title:"Custom Gateway",permalink:"/en/docs/noslate_workers/tutorials/custom_gateway"}},c={},l=[{value:"Convert Request Format",id:"convert-request-format",level:2},{value:"HTTP Request",id:"http-request",level:4},{value:"Event Request",id:"event-request",level:4},{value:"Call and process the response data",id:"call-and-process-the-response-data",level:2},{value:"Update Worker Function/Service Routing Configuration",id:"update-worker-functionservice-routing-configuration",level:2}],u={toc:l};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"gateway"},"Gateway"),(0,a.kt)("p",null,"It is mainly used to complete the docking with the external traffic portal, and realize the call to Noslate together with the ",(0,a.kt)("a",{parentName:"p",href:"/en/docs/noslate_workers/references/sdk"},"SDK"),"."),(0,a.kt)("h2",{id:"convert-request-format"},"Convert Request Format"),(0,a.kt)("p",null,"The Gateway needs to convert the format of the external traffic into a format usable by Data Plane:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Function/Service Distinguished Name"),(0,a.kt)("li",{parentName:"ol"},"Buffer/Readable Stream call data"),(0,a.kt)("li",{parentName:"ol"},"Metadata information, including: url, method, headers, baggage, timeout, requestId, etc.\nFor different request forms, different conversions need to be done:")),(0,a.kt)("h4",{id:"http-request"},"HTTP Request"),(0,a.kt)("p",null,"You can get the name of the specific Worker function/service call in the request header, convert the request url, method, headers and other information into Metadata form, and pass in the request body as data, such as:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -X POST http://127.0.0.1/invoke -H "trace-id: 1000" -H "noslate-target:service|a" -d "ok"\n')),(0,a.kt)("p",null,"Convert to"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'await invokeService("a", Buffer.from("ok"), {\n    url: "/invoke"\n    headers: [\n        ["trace-id", "1000"]\n    ]\n});\n')),(0,a.kt)("h4",{id:"event-request"},"Event Request"),(0,a.kt)("p",null,"You can put the name of the specific Worker function/service invocation in the invocation parameters, or in the meta information of the request itself. The information required by Metadata can be mapped according to the actual situation or replaced by constants, such as:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'// timed trigger\n{\n    "triggerTime":"2018-02-09T05:49:00Z",\n    "triggerName":"timer-trigger",\n    "payload":"function:awesome-fc,ok"\n}            \n')),(0,a.kt)("p",null,"convert to"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'await invoke("awesome-fc", Buffer.from("ok"), {\n    url: "/timer-trigger"\n    headers: [\n        ["triggerTime", "2018-02-09T05:49:00Z"]\n    ]\n});\n')),(0,a.kt)("h2",{id:"call-and-process-the-response-data"},"Call and process the response data"),(0,a.kt)("p",null,"Execute specific Worker functions through the invoke/invokeService interface exposed by ",(0,a.kt)("a",{parentName:"p",href:"/en/docs/noslate_workers/references/sdk"},"SDK"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"const response = await agent.invoke(name, data, metadata);\nconst response = await agent.invokeService(name, data, metadata);\n")),(0,a.kt)("p",null,"The invoke/invokeService interface is returned in the form of a stream, which can be directly piped into the response stream, such as HTTP Response. If you need to get the data in the form of Buffer, you can refer to:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"async function bufferFromStream(stream: Readable): Promise<Buffer> {\n  const chunks = [];\n\n  for await (const chunk of stream) {\n    chunks.push(chunk);\n  }\n\n  return Buffer.concat(chunks);\n}\n\nawait bufferFromStream(response);\n")),(0,a.kt)("h2",{id:"update-worker-functionservice-routing-configuration"},"Update Worker Function/Service Routing Configuration"),(0,a.kt)("p",null,"In addition to processing the incoming and outgoing requests, the Gateway also needs to update the Worker function/service routing configuration to ",(0,a.kt)("a",{parentName:"p",href:"noslate_workers/noslated/intro"},"Noslated")," in time:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"await agent.setFunctionProfile(config);\nawait agent.setServiceProfile(config);\n")),(0,a.kt)("p",null,"The configuration content can be stored in local files or connected to various configuration management systems."),(0,a.kt)("p",null,"If necessary, you can refer to the document ",(0,a.kt)("a",{parentName:"p",href:"/en/docs/noslate_workers/tutorials/custom_gateway"},"Custom Gateway")," to customize the Gateway module."))}p.isMDXComponent=!0}}]);